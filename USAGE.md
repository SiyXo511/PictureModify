# 图片修改工具 - 使用说明

## 安装依赖

首先安装所需的Python包：

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install PyQt5 Pillow opencv-python numpy paddlepaddle paddleocr PyInstaller
```

**注意**：PaddleOCR首次使用时会自动下载模型文件（约100MB），需要网络连接。

## 运行程序

### 方式一：直接运行

```bash
python src/main.py
```

### 方式二：打包成exe

```bash
python build_exe.py
```

打包完成后，可执行文件位于 `dist/PictureModify.exe`

## 功能使用

### 1. 打开图片

- 点击菜单栏"文件" -> "打开"
- 或点击工具栏"打开"按钮
- 或使用快捷键 `Ctrl+O`
- 支持格式：JPG, PNG, BMP, GIF, WEBP等

### 2. 选择区域

- 在图片上按住鼠标左键拖拽，选择矩形区域
- 选择框会以红色虚线显示
- 点击空白区域可取消选择

### 3. 垂直删除拼接

1. 选择要删除的垂直区域
2. 点击菜单栏"工具" -> "垂直删除拼接"
   - 或点击工具栏"垂直删除"按钮
3. 选中的区域将被删除，上下两部分会自动拼接

### 4. 智能填充

1. 选择要填充的区域
2. 点击菜单栏"工具" -> "智能填充"
   - 或点击工具栏"智能填充"按钮
3. 选择填充模式：
   - **智能填充**：使用OpenCV的inpaint算法，效果最自然（推荐）
   - **平均颜色填充**：使用周围像素的平均颜色
   - **中位数填充**：使用周围像素的中位数颜色
   - **纯色填充**：选择颜色后填充

### 5. 文字识别与替换

#### 5.1 文字识别

1. 选择包含文字的区域
2. 点击菜单栏"工具" -> "文字识别"
   - 或点击工具栏"文字识别"按钮
3. 等待识别完成（首次使用可能需要下载模型）
4. 识别结果会显示在对话框中，包括：
   - 文字内容
   - 位置坐标
   - 识别置信度

#### 5.2 删除文字

1. 在文字识别结果对话框中，选择要删除的文字（可多选）
2. 点击"删除选中文字"按钮
3. 文字将被智能删除，背景会自动填充

#### 5.3 替换文字

1. 在文字识别结果对话框中，选择要替换的文字
2. 点击"替换选中文字"按钮
3. 在替换对话框中：
   - 查看原文字内容
   - 输入新文字
   - 调整字体参数（字体、大小、颜色）
   - 点击"确定"完成替换

**注意**：字体自动匹配可能不完全准确，建议手动调整字体参数以获得最佳效果。

### 6. 撤销/重做

- 撤销：`Ctrl+Z` 或点击工具栏"撤销"按钮
- 重做：`Ctrl+Y` 或点击工具栏"重做"按钮
- 支持最多20步历史记录

### 7. 保存图片

- 保存：`Ctrl+S` 或点击工具栏"保存"按钮
- 另存为：`Ctrl+Shift+S` 或菜单栏"文件" -> "另存为"

### 8. 视图操作

- 适应窗口：自动缩放图片以适应窗口
- 放大：`Ctrl++` 或鼠标滚轮向上
- 缩小：`Ctrl+-` 或鼠标滚轮向下
- 重置缩放：恢复原始大小

## 常见问题

### Q: OCR识别失败？

A: 
- 确保已安装PaddleOCR：`pip install paddlepaddle paddleocr`
- 首次使用需要下载模型，确保网络连接正常
- 如果PaddleOCR安装失败，可以尝试使用EasyOCR作为备选

### Q: 字体匹配不准确？

A: 
- 字体自动匹配是近似匹配，可能不完全准确
- 在替换文字对话框中可以手动选择字体
- 可以调整字体大小和颜色以获得最佳效果

### Q: 程序运行缓慢？

A: 
- OCR识别和图像处理可能需要一些时间，请耐心等待
- 大图片处理时建议先缩小图片
- 如果处理时间过长，可以尝试使用更简单的填充模式

### Q: 打包后的exe文件很大？

A: 
- 这是正常的，因为包含了所有依赖库和OCR模型
- 如果文件过大，可以尝试使用 `--onedir` 模式而不是 `--onefile`

## 技术支持

如有问题或建议，请查看项目文档或提交Issue。

